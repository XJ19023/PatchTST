import numpy as np
import matplotlib.pyplot as plt
import matplotlib
from mpl_toolkits.axes_grid1.inset_locator import mark_inset
from mpl_toolkits.axes_grid1.inset_locator import inset_axes
import matplotlib.patches as patches
from matplotlib.ticker import PercentFormatter
import torch

torch.set_printoptions(
    precision=8,
    sci_mode=False,   # 关闭科学计数法
    linewidth=120,    # 一行显示更多
)

base = torch.tensor([0.1492039 , 0.14929476, 0.1486522 , 0.15035428,])
tensor = torch.tensor([0.14921825, 0.14924949, 0.14925988, 0.14923269, 0.14928672, 0.14919995, 0.14924081, 0.14919186, 0.14918517, 0.14917365, 0.14920647, 0.14920723, 0.1492023 , 0.14918676, 0.14917248, 0.1492089 , 0.14919207, 0.14917108, 0.14920744, 0.14920548, 0.14919832, 0.1491829 , 0.14920595, 0.14919098, 0.14919885, 0.14919642, 0.14920138, 0.14920935, 0.1491977 , 0.14919695, 0.14919235, 0.14921485, 0.14919926, 0.14921996, 0.14920147, 0.14920549, 0.14920034, 0.14925672, 0.14925152, 0.14920585, 0.1492849 , 0.14915937, 0.14926264, 0.14917612, 0.14915733, 0.149832  , 0.15015386, 0.14937307, 0.14959098, 0.14921851, 0.14937167, 0.14948441, 0.14927144, 0.14946449, 0.15043643, 0.15038796, 0.15026504, 0.14995122, 0.14933354, 0.14936446, 0.14948054, 0.14968178, 0.149638  , 0.14950249, 0.14928299, 0.14940503, 0.14941393, 0.14942721, 0.14924771, 0.14906174, 0.14908668, 0.14916618, 0.14956176, 0.14937286, 0.14938289, 0.149332  , 0.14940523, 0.14952771, 0.14949417, 0.14947763, 0.14935377, 0.15179004, 0.15116222, 0.15032701, 0.15050758, 0.1494742 , 0.14954875, 0.14954752, 0.14974532, 0.14991428, 0.14865656, 0.1486672 , 0.14865899, 0.14865239, 0.14862598, 0.14864063, 0.1486471 , 0.14861256, 0.14864822, 0.14868741, 0.14864376, 0.14866577, 0.14866163, 0.1486344 , 0.1486484 , 0.1486482 , 0.1486523 , 0.14866544, 0.14862718, 0.14865971, 0.14865363, 0.14863175, 0.14865173, 0.1486375 , 0.14865761, 0.14864615, 0.14865634, 0.14865668, 0.1486592 , 0.14866443, 0.14866079, 0.14865755, 0.14866987, 0.14865884, 0.14865941, 0.14865786, 0.14866933, 0.14867745, 0.14868954, 0.14865409, 0.14861558, 0.14863895, 0.14865015, 0.14862017, 0.14866608, 0.1502669 , 0.14986724, 0.14988966, 0.14939782, 0.14887613, 0.14878024, 0.14909646, 0.14932029, 0.14964552, 0.15234853, 0.15239078, 0.15099461, 0.15053892, 0.15068948, 0.15070012, 0.15045102, 0.15014611, 0.14994019, 0.14997052, 0.14994827, 0.14984316, 0.14999288, 0.149994  , 0.15002449, 0.15020567, 0.1502157 , 0.15010032, 0.14977071, 0.14984562, 0.14975058, 0.14972652, 0.15008359, 0.15010957, 0.15027873, 0.15049814, 0.15026875, 0.15177515, 0.15125161, 0.14942993, 0.14919767, 0.14900935, 0.14861579, 0.14865519, 0.14878418, 0.14869578,])

# print(tensor.min())

tensor = tensor.reshape(-1, 9) # (quant_meth, alpha)
data = tensor.clone()

value, index = tensor.min(dim=-1, keepdim=True) # best alpha
for v, i in zip(value, index):
    print(f'{v.item():.8f}, {(9 - i.item())/10}')

tensor = value.reshape(-1, 5) # (quant_meth, smooth_module)
base = base.reshape(-1, 1)
# print(base.shape)
# print(tensor.shape)
mask = tensor < base
# print(mask)
# print(tensor.masked_fill(~mask, 0))


colors = [(70/255, 120/255, 142/255), (120/255, 183/255, 201/255), (187/255, 151/255, 39/255), (50/255, 184/255, 151/255), (199/255, 109/255, 162/255), (70/255, 120/255, 142/255)]
width = 0.6
fig, ax = plt.subplots(4, 5, figsize=(12, 8), dpi=300)

xticks = np.arange(0, data.size(1))
xticks = torch.tensor(xticks)

for i in range(data.size(0)):
    plt.subplot(4, 5, i+1)
    plt.plot(xticks, data[i], linewidth=0.5, zorder=3)
    # plt.xlim(-0.5, 4.5)
    plt.xticks(xticks, labels=[f'{(9-dut)}' for dut in np.arange(9)], fontsize=9)
    plt.tick_params(bottom=False, left=False)
    # plt.xlabel('Smooth Module')
    # plt.ylabel('MSE')
    plt.grid(True, axis='y', linestyle='--', color='lightgray', zorder=0)

plt.tight_layout()
plt.savefig(f'aaa.png')
plt.savefig(f'alpha.pdf')
plt.close()
